{%extends "admin-dashboard/admin_base.html"%}
{% load static %}
{%block title_block%}{{page_title}}{%endblock%}
{%block body_block%}
<style>
    
    #active-jobs_previous, #active-jobs_current, #active-jobs_info, #current-application_info, #current-application_length, #current-application_previous, #current-application_next, 
    #active-jobs_next {
        display: none ;
    }
    
</style>
<div class="box-content">
    <div class="box-heading">
        <div class="box-title">
            <h3 class="mb-35">Approved Applications</h3>
        </div>
        <div class="box-breadcrumb">
            <div class="breadcrumbs">
                <ul>
                    <li> <a class="icon-home" href="/admin-dashboard">Home</a></li>
                    <li><span>Approved Applications</span></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xxl-12 col-xl-12 col-lg-12">
            <div class="section-box">
                <div class="container">
                    <div class="panel-white mb-30">
                        <div class="box-padding">
                            <div class="mb-30 float-right w-100 d-flex justify-content-between align-items-center">
                                <div class="pagination-info">
                                    {% if job_applications %}
                                    Showing {{ job_applications.start_index }} to {{ job_applications.end_index }} 
                                    of {{ job_applications.paginator.count }} entries
                                    {% endif %}
                                </div>
                                <div class="pagination-controls">
                                    <button class="btn btn-danger mr-10 btn-sm py-2" data-type="job_app" id="disable_all">Reject</button>
                                </div>
                            </div>
                            <div class="table-responsive">
                            <table id="current-application" class="row-border hover" style="width:100%">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="multiple_teacher_selection_all" class="form-check-input"></th>
                                        <th>Applied On</th>
                                        <th>Joined On</th>
                                        <th>Last Login</th>
                                        <th>Job Code</th>
                                        <th>School Name</th>
                                        <th>Teacher Name</th>
                                        <th>Gender</th>
                                        <th>Mobile No</th>
                                        <th>Alt Mobile No</th>
                                        <th>Qualification</th>
                                        <th>Work Exp.</th>
                                        <th>Exp. In</th>
                                        <th>Subjects</th>
                                        <th>Current Salary</th>
                                        <th>Expected Salary</th>
                                        <th>Preferred Location</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for job_application in job_applications %}
                                    <tr>
                                        <td>
                                            <input type="checkbox" data-id="{{job_application.id}}" value="{{job_application.id}}" name="multiple_teacher_selection" class="form-check-input multiple_teacher_selection">
                                        </td>
                                        <td>{{job_application.timestamp | date:"d M Y"}}</td>
                                        <td>{{job_application.teacher.user.joining_date| date:"d M Y"}}</td>
                                        <td>{{job_application.teacher.user.last_login| date:"d M Y"}}</td>
                                        {% if job_application.job %}
                                        <td><a class="btn btn-info text-white py-1 jobcode" data-id="{{job_application.job.id}}" href="#Job-Detail"  data-bs-toggle="modal">{{job_application.job.job_code}}</a></td>
                                        {% else %}
                                        <td><a class="btn btn-info text-white py-1 jobcode" data-id="{{job_application.walkin_job.id}}" href="#Job-Detail"  data-bs-toggle="modal">{{job_application.walkin_job.job_code}}</a></td>
                                        {% endif %}

                                        <td>{{job_application.job.user.name}}</td>                                    
                                        <td>{{job_application.teacher.user.name}}</td>
                                        <td>{{job_application.teacher.gender}}</td>
                                        <td>{{job_application.teacher.user.mobile_no}}</td>
                                        <td>{{job_application.teacher.user.alt_mobile_no}}</td>
                                        <td>{{job_application.teacher.qualification}}</td>
                                        <td>{{job_application.teacher.years_of_experience}}</td>
                                        <td>{{job_application.teacher.experience_in}}</td>
                                        <td>{{job_application.teacher.subject_of_experience}},</td>
                                        <td>{{job_application.teacher.current_salary}}</td>
                                        <td>{{job_application.teacher.expected_salary}}</td>
                                        <td>{{job_application.teacher.preferred_location_district}}</td>
                                    </tr>   
                                    {% endfor %}                                
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination Controls -->
                        <div class="pagination-footer d-flex justify-content-center align-items-center mt-3">
                            <div class="pagination-pages">
                                {% if job_applications.has_other_pages %}
                                <nav aria-label="Page navigation">
                                    <ul class="pagination">
                                        {% if job_applications.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page=1" aria-label="First">
                                                <span aria-hidden="true">First</span>
                                            </a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ job_applications.previous_page_number }}" aria-label="Previous">
                                                <span aria-hidden="true">Prev</span>
                                            </a>
                                        </li>
                                        {% endif %}

                                        {% for num in job_applications.paginator.page_range %}
                                            {% if job_applications.number == num %}
                                                <li class="page-item active">
                                                    <span class="page-link">{{ num }}</span>
                                                </li>
                                            {% elif num > job_applications.number|add:"-4" and num < job_applications.number|add:"+4" %}
                                                <li class="page-item">
                                                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                                </li>
                                            {% endif %}
                                        {% endfor %}

                                        {% if job_applications.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ job_applications.next_page_number }}" aria-label="Next">
                                                <span aria-hidden="true">Next</span>
                                            </a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ job_applications.paginator.num_pages }}" aria-label="Last">
                                                <span aria-hidden="true">Last</span>
                                            </a>
                                        </li>
                                        {% endif %}
                                    </ul>
                                </nav>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--Employer -->
<div class="modal fade" id="Job-Detail" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog " role="document">
        <div class="modal-content apply-job-form">
            <div class="modal-header">
                <h5 class="modal-title" id="Activity-Detail">Job Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="modal-list" id="job_body">
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<style>
.pagination .page-item.active .page-link {
    background-color: #007bff;
    color: white;
}
.pagination-info {
    font-size: 0.875rem;
    color: #6c757d;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Optional: Add query parameter preservation for other filters
    const paginationLinks = document.querySelectorAll('.pagination .page-link');
    paginationLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            const currentUrl = new URL(window.location.href);
            const clickedUrl = new URL(this.href);
            
            // Preserve other query parameters
            currentUrl.searchParams.forEach((value, key) => {
                if (key !== 'page') {
                    clickedUrl.searchParams.set(key, value);
                }
            });
            
            window.location.href = clickedUrl.toString();
            e.preventDefault();
        });
    });
});
</script>